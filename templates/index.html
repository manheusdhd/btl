<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Flask Messenger</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <header><h1>üí¨ Flask Messenger</h1></header>

    <!-- Form g·ª≠i / s·ª≠a -->
    <form id="chat-form" action="/send" method="post" class="form">
      <input id="name-input" name="name" placeholder="T√™n (t√πy)">
      <input id="message-input" name="text" placeholder="Nh·∫≠p tin nh·∫Øn..." required autocomplete="off">
      <button id="send-btn" type="submit">G·ª≠i</button>
      <button id="cancel-edit-btn" type="button" class="btn-cancel" style="display:none">H·ªßy</button>
    </form>

    <!-- Danh s√°ch tin nh·∫Øn -->
    <ul class="messages">
      {% for m in messages %}
      <li data-id="{{ loop.index0 }}">
        <div class="msg-left">
          <strong class="name" data-name="{{ m.name }}">{{ m.name }}</strong>
          <span class="colon">:</span>
          <span class="text">{{ m.text }}</span>
        </div>
        <div class="controls">
          <button class="edit-btn" title="S·ª≠a">S·ª≠a</button>
          <form action="/delete/{{ loop.index0 }}" method="post" class="delete-form" onsubmit="return confirm('X√≥a tin nh·∫Øn n√†y?');">
            <button type="submit" class="delete-btn" title="X√≥a">X√≥a</button>
          </form>
        </div>
      </li>
      {% else %}
      <li class="empty">Ch∆∞a c√≥ tin nh·∫Øn n√†o.</li>
      {% endfor %}
    </ul>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const chatForm = document.getElementById('chat-form');
  const messageInput = document.getElementById('message-input');
  const nameInput = document.getElementById('name-input');
  const sendBtn = document.getElementById('send-btn');
  const cancelBtn = document.getElementById('cancel-edit-btn');

  // Ch·ª©c nƒÉng nh·∫Øc t√™n: click v√†o t√™n s·∫Ω ch√®n @T√™n v√†o √¥ nh·∫≠p
  document.querySelectorAll('.name').forEach(el => {
    el.addEventListener('click', () => {
      const n = el.dataset.name || '';
      messageInput.value = '@' + n + (messageInput.value ? (' ' + messageInput.value) : ' ');
      messageInput.focus();
    });
  });

  // Ch·ª©c nƒÉng S·ª≠a: x·ª≠ l√Ω to√†n b·ªô n√∫t S·ª≠a
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      const li = btn.closest('li');
      if (!li) return;
      const id = li.dataset.id;
      const textEl = li.querySelector('.text');
      const text = textEl ? textEl.textContent.trim() : '';
      // ƒê·∫∑t form sang ch·∫ø ƒë·ªô edit
      chatForm.action = '/edit/' + id;
      messageInput.value = text;
      sendBtn.textContent = 'L∆∞u';
      cancelBtn.style.display = 'inline-block';
      // N·∫øu mu·ªën: set ph√≠m focus
      messageInput.focus();
    });
  });

  // H·ªßy s·ª≠a ‚Äî tr·∫£ v·ªÅ action ban ƒë·∫ßu
  cancelBtn.addEventListener('click', (e) => {
    e.preventDefault();
    chatForm.action = '/send';
    messageInput.value = '';
    sendBtn.textContent = 'G·ª≠i';
    cancelBtn.style.display = 'none';
  });

  // Khi submit form (g·ª≠i), sau redirect server s·∫Ω load l·∫°i view => tr·∫°ng th√°i form reset nh·ªù action /send
});
</script>
</body>
</html>
